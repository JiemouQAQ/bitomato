Windows 桌面番茄钟 — 产品需求文档（PRD）

一、产品概述
- 产品名称：bitomato
- 产品定位：在 Windows 桌面上以置顶的像素皮肤形态显示番茄工作法计时与状态，突出像素风格美学与最小化干扰。
- 目标用户：偏好极简工作流、喜爱像素风格 UI 的 Windows 用户；程序员、设计师、学生等需要专注工作的人群。
- 产品目标：在不占用过多屏幕空间的前提下，提供稳定、直观、可定制皮肤的番茄钟体验。
- 授权协议：Apache License 2.0

二、核心功能
- 桌面置顶：应用窗口始终置顶显示，不被其他应用遮挡；该行为为强制开启，不可关闭。
- 无边框：主窗口采用无边框方案，移除系统标题栏与边框，通过拖拽图片实现窗口移动。
- 透明背景：窗口背景透明，仅显示皮肤与文本与叠加图标，便于与桌面自然融合。
- 皮肤与尺寸：皮肤为 256×256 PNG 序列或单帧；从皮肤目录加载。支持通过 `skin.json` 定义皮肤元数据（如文字颜色）。
- 字体与排版：计时数字使用 `Minecraftia-Regular.ttf` 字体，字号 48；以皮肤图片的坐标系为准，将数字的左上角定位在 (53, 173)。
- 默认缩放：应用默认对皮肤、按钮与数字进行 1× 放大（窗口尺寸 256×256）；支持 0.5× - 3.0× 缩放调节（通过托盘或设置）。
- 计时显示格式：采用两位数风格 `xx:xx`（例如 `25:00`、`05:00`），统一前导零，风格与 24 小时制时间书写一致。
- 番茄流程：默认工作 25 分钟、短休 5 分钟；可在设置中配置，范围为 1-99 分钟。
- 控制与交互：开始/暂停/重置/跳过当前阶段；开关结束提醒（提示音）。
- 叠加按钮：
  - 开始/暂停按钮：以坐标 (132, 230) 为左上角锚点，大小 24×24，默认显示 `start.png`；点击开始后切换为 `pause.png`，再次点击后进入暂停并切回 `start.png`。
  - 重置按钮：以坐标 (164, 230) 为左上角锚点，大小 24×24；图标使用 `reset.png`；点击后：
    1. 如果勾选“正计时模式”：数字显示变为 `00:00`。
    2. 如果未勾选“正计时模式”：数字显示变为专注时间对应的时长（如 `25:00`）。
    3. 点击 reset 按钮时，如果该次计时已大于 2 分钟，则纳入统计。
  - 设置按钮：以坐标 (196, 230) 为左上角锚点，大小 24×24；图标使用 `setting.png`；点击打开设置后主窗口暂停，同时弹出设置窗口。
- 设置窗口功能：
  - 调整“专注时间（分）”、“休息时间（分）”（范围 1-99，步长 ±5）。
  - 调整“动画速度(ms)”（步长 ±50）。
  - 缩放倍率按钮：点击弹出调整缩放对话框。
  - “正计时模式”开关：开启后进入正计时（无休息时段），最大专注 99 分钟。
  - “手动开启休息”开关：开启后专注结束停在 `00:00` 并进入待开始状态，需再次点击开始按钮才进入休息阶段；**正计时模式下强制开启**。
  - “结束提醒音效”开关及自定义音效功能（支持 MP3/WAV，显示文件名，支持恢复默认）。
  - “数字显示色”：显示当前颜色预览，点击按钮可打开调色盘调整颜色（默认白色）。
  - “数字描边色”：开启/关闭数字描边，设置描边颜色（默认关闭，黑色，宽度固定为1）。
  - “统计”按钮：进入统计面板，显示总专注次数、总时长、喜好专注时段（>50%，仅在专注 5 次以上后生成）。
- 系统托盘：
  - 图标使用 `tray.ico`；如果不存在则降级使用 `tray.png`。
  - 托盘菜单：
    - 显示/隐藏
    - 调整缩放倍率
    - 更换皮肤
    - 开始/暂停
    - 重置
    - 设置
    - 数据备份（子菜单）：
      - 手动备份：在备份文件夹内生成最新备份文件（ZIP格式，包含 stats.json）。
      - 开启自动备份：每次番茄钟结束后自动备份，仅保留最新一份。
      - 导入备份文件：选择 ZIP 文件恢复数据。
      - 查看备份文件：打开备份文件夹。
      - 清空历史数据：清空当前所有统计数据，不影响已备份文件。
    - 关于：显示软件名、制作人、版本及免责声明（可展开阅读）。
    - 退出
- 提醒与反馈：
  - 阶段结束播放提示音（支持自定义或默认 Beep）。
  - 结束视觉提醒：计时完成时数字停在 `00:00`，红/白闪烁 3 次。
- 启动与持久化：设置（皮肤、时长、帧率、音效、备份配置等）持久化到配置文件。

三、皮肤与资源规范
- 目录结构约定：
  - `skins/<skin_id>/` 为皮肤目录；每个皮肤一个子目录。
  - 支持两种素材形态：
    - 单帧：`skin.png`（大小必须为 256×256）。
    - 序列帧：按升序命名，如 `skin_000.png`、`skin_001.png`…（每帧 256×256）。
  - 字体资源位置建议：`assets/fonts/Minecraftia-Regular.ttf`。
  - 资源路径解析：所有资源均以“项目根目录”为基准（不是当前工作目录）。
- 序列播放：
  - 默认帧率对应间隔 100ms（可在配置中设置 `frameDuration`）。
  - 未检测到序列时使用单帧 `skin.png` 静态显示。
- 坐标系：
  - 皮肤画布左上角为 (0, 0)，右下角为 (255, 255)。
  - 计时文本以左上角 (53, 173) 定位，字号为 48；保证两位数宽度一致，冒号等宽处理。
- 像素风清晰度：
  - 禁用文本抗锯齿以保持像素字体清晰；启用整像素对齐。
- 图标资源与尺寸：
  - `assets/icons/start.png`、`assets/icons/pause.png`、`assets/icons/setting.png`、`assets/icons/reset.png`（均为 24×24）。
  - 系统托盘图标：`assets/tray/tray.ico`（默认为 128×128）。
- UI 缩放：可通过配置 `uiScale` 控制（默认 1）。

四、用户流程（示例）
- 首次打开：读取默认皮肤与配置；窗口置顶显示。
- 选择皮肤：在配置文件中切换 `skinId`；序列或单帧自动识别。支持通过托盘菜单“更换皮肤”手动选择皮肤文件夹（需包含 256×256 资源）。
- 开始计时：点击开始按钮（`start.png`，左上角 (132, 230)，大小 24×24）进入工作阶段；界面显示 `25:00` 并倒计时，按钮切换为 `pause.png`。
- 暂停与恢复：点击 `pause.png` 暂停计时并切回 `start.png`，再次点击恢复计时。
- 重新开始：点击 `reset.png`（左上角 (164, 230)，大小 24×24）。
- 设置：点击设置按钮（`setting.png`，左上角 (196, 230)，大小 24×24）进入设置。
- 窗口移动：在非按钮区域按住并拖拽图片可移动无边框窗口。
- 阶段切换：结束后自动进入短休；播放提示音（可关闭）。
- 数据备份：通过托盘菜单管理数据备份与恢复。
- 关于：通过托盘菜单查看软件信息与免责声明。

五、配置项（`config.json` 建议）
- `workMinutes`: 工作分钟数（默认 25，范围 1–99）
- `shortBreakMinutes`: 休息分钟数（默认 5，范围 1–99）
- `skinId`: 当前皮肤目录名（默认 `default`）
- `frameDuration`: 帧间隔毫秒数（默认 100）
- `uiScale`: UI 缩放倍数（默认 1）
- `soundEnabled`: 是否开启结束提醒（默认 true）
- `customSoundPath`: 自定义音效路径（默认 ""）
- `manualBreak`: 是否手动开启休息（默认 false）
- `countUpMode`: 是否正计时模式（默认 false）
- `textColor`: 数字显示颜色（默认 "#FFFFFF"）
- `textOutlineEnabled`: 数字描边开关（默认 false）
- `textOutlineColor`: 数字描边颜色（默认 "#000000"）
- `textOutlineWidth`: 数字描边宽度（固定为 1）
- `autoBackup`: 是否开启自动备份（默认 false）

六、非功能性与兼容性要求
- 平台兼容：Windows 10/11（x64）。
- 性能目标：CPU 占用 < 5%，内存占用 < 50 MB（静态皮肤场景下）。
- 稳定性：异常资源（缺帧/缺字体）需降级处理并给出提示；不崩溃。
- 启动时间：冷启动 < 1 秒（无庞大序列加载场景下）。
- 安全与隐私：不采集用户数据；本地配置仅保存必要设置。
- 打包：使用 PyInstaller 打包为单文件 EXE。

七、验收标准（关键检查点）
- 置顶窗口在各种应用前均可见，且不影响其他应用操作。
- 皮肤素材尺寸为 128×128，超出或不足需报错并拒绝加载。
- 文本的中心定位正确，视觉上与像素网格对齐，无模糊。
- 计时格式始终为两位数 `xx:xx`，包含前导零。
- 默认番茄流程与自动切换符合配置；跳过/重置行为正确。
- 统计规则：< 2 分钟不统计；> 5 次生成喜好时段。
- 备份功能：生成 ZIP，包含正确数据；导入能恢复数据。
- 提示音与通知在阶段切换时触发；可独立关闭或自定义。
- 叠加按钮点击逻辑正确。
- 系统托盘图标显示正确，托盘菜单功能完整。
- 无边框移动行为：非按钮区域拖拽能平滑移动窗口。
- 配置修改后持久化保存；重启后生效。


